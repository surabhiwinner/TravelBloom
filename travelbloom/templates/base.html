<!DOCTYPE html>
<html lang="en">
<head>
    <title>SmartVoyager

</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Travelix Project">
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- CSS -->
    <!-- <link rel="stylesheet" type="text/css" href="/static/styles/bootstrap4/bootstrap.min.css"> -->
    <link href="/static/plugins/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/static/plugins/OwlCarousel2-2.2.1/owl.carousel.css">
    <link rel="stylesheet" type="text/css" href="/static/plugins/OwlCarousel2-2.2.1/owl.theme.default.css">
    <link rel="stylesheet" type="text/css" href="/static/plugins/OwlCarousel2-2.2.1/animate.css">
    <link rel="stylesheet" type="text/css" href="/static/styles/main_styles.css">
    <link rel="stylesheet" type="text/css" href="/static/styles/responsive.css">

<!-- Bootstrap CSS (in <head>) -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Bootstrap JS Bundle (before </body>) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>



    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- FontAwesome -->
    <!-- FontAwesome v6 (latest) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Swiper -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    
</head>

<body>

<style>
  .navbar-custom-bg {
  background-color: rgba(0, 0, 0, 0); /* dark with slight transparency */
}
.social_list {
  padding: 0;
  margin: 0;
}

.social_list li {
  list-style: none;
  margin: 0 10px;
}

.social_list a {
  display: inline-flex;
  justify-content: center;
  align-items: center;
  width: 40px;
  height: 30px;
  padding: 2px;
  border-radius: 20%;
  background: #f0f0f0;
  color: #333;
  font-size: 20px;
  text-decoration: none;
  transition: all 0.3s ease;
}

.social_list a:hover {
  background: #007bff;
  color: #fff;
  transform: scale(1.2);
  box-shadow: 0 4px 15px rgba(0, 123, 255, 0.4);
}

#chat-toggle {
  background: #007bff;
  border: none;
  color: white;
  font-size: 22px;
  border-radius: 50%;
  width: 60px;
  height: 60px;
  box-shadow: 0 4px 15px rgba(0, 123, 255, 0.4);
  transition: all 0.3s ease;
}

#chat-toggle:hover {
  transform: scale(1.1);
}

.chatbox {
  display: none;
  width: 320px;
  height: 420px;
  background: white;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
  animation: slideUp 0.3s ease-out;
  position: relative;
  flex-direction: column;
}

@keyframes slideUp {
  from {
    transform: translateY(30px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

#chatbox-header {
  background: #007bff;
  color: white;
  padding: 12px;
  font-weight: bold;
  text-align: center;
}

.chatbox-messages {
  height: 300px;
  padding: 10px;
  overflow-y: auto;
  font-size: 14px;
}

#chatbox-footer {
  padding: 10px;
  background: #f9f9f9;
  display: flex;
  gap: 5px;
}

#chatbox-footer input {
  flex: 1;
  border: 1px solid #ccc;
  padding: 8px;
  border-radius: 5px;
}

#chatbox-footer button {
  background: #28a745;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 5px;
}
</style>

<div class="super_container">

    <!-- Header -->
    <header class="header">
        <div class="top_bar" style="background-color: #11062e;">
            <div class="container">
                <div class="row">
                    <div class="col d-flex flex-row">
                        <div class="phone"><a href="tel:+916238483490" style="text-decoration:none; color: #ccc;">+91 623 848 3490</a></div>
                        <div class="social ml-auto">
  <ul class="social_list d-flex align-items-center">
    <li><a href="#"><i class="fab fa-facebook-f"></i></a></li>
    <li><a href="#"><i class="fab fa-twitter"></i></a></li>
    <li><a href="#"><i class="fab fa-instagram"></i></a></li>
    <li><a href="#"><i class="fab fa-linkedin-in"></i></a></li>
    <li><a href="#"><i class="fab fa-pinterest-p"></i></a></li>
  </ul>
</div>
                      {%if not request.user.is_authenticated %}
                        <div class="user_box ml-4">
                            <a href="{% url 'login' %}">Login</a> / <a href="{% url 'register' %}">Register</a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg navbar-dark navbar-custom" style="background-color: #340f6e;">
            <div class="container">
                <a class="navbar-brand" href="#">
                    <img src="/static/images/logo.png" alt="Logo" style="height: 30px;"> SmartVoyager


                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="mainNavbar">
                    <ul class="navbar-nav ms-auto d-flex align-items-center gap-3">
                        <li class="nav-item">
                            <a class="nav-link {% if page == 'home-page' %}text-white {% else %}fw-bold text-secondary{% endif %}" href="{% url 'home' %}">Home</a>
                        </li>
                        
                        <!-- <li class="nav-item">
                            <a class="nav-link {% if page == 'map-page' %}text-white {% else %}fw-bold text-secondary{% endif %}" href="{% url 'map' %}">Map</a>
                        </li> -->

                        {% user_role_checking request 'Admin,User' as allow %}
                        {% if allow %}
                        <li class="nav-item">
                            <a class="nav-link {% if page == 'diary-page' %}text-white {% else %}fw-bold text-secondary{% endif %}" href="{% url 'diary-list' %}">Diary</a>
                        </li>
                        
                        {% endif %}



                         
                        <li class="nav-item">
                            <a class="nav-link {% if page == 'planner-page' %}text-white {% else %}fw-bold text-secondary{% endif %}" href="{% url 'planner' %}">Trip Planner</a>
                        </li>
                       
                        


                        {% user_role_checking request 'Admin,User' as allow %}
                        {% if allow %}
                        <li class="nav-item">
                            <a class="nav-link {% if page == 'your-trip-page' %}text-white {% else %} fw-bold text-secondary{% endif %}" href="{% url 'your-trip' %}">Your Trip</a>
                        </li>
                        
                        {% endif %}

                        

                        <li class="nav-item">
                            <a class="nav-link {% if page == 'blog-page' %}text-white {% else %} fw-bold text-secondary{% endif %}" href="{% url 'blog-list' %}">Blog</a>
                        </li>


  {% if request.user.is_authenticated %}
  {% if request.user.traveller.has_premium_access %}
    <li class="nav-item">
      <a class="nav-link {% if page == 'contact-page' %}text-white{% else %}fw-bold text-secondary{% endif %}" href="{% url 'contact' %}">
        Contact
      </a>
    </li>
  {% else %}
    <li class="nav-item">
      <a class="btn btn-sm btn-warning fw-bold ms-2" style="background-color: gold;" href="{% url 'razorpay-page' request.user.traveller.uuid %}">
        Unlock Premium
      </a>
    </li>
  {% endif %}
{% else %}
  <li class="nav-item">
    <a class="nav-link {% if page == 'contact-page' %}text-white{% else %}fw-bold text-secondary{% endif %}" href="{% url 'contact' %}">
      Contact
    </a>
  </li>
{% endif %}



{% if request.user.is_authenticated %}
    <div class="nav-item dropdown">
        <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userDropdown" data-bs-toggle="dropdown">
            <img src="{% if request.user.traveller.image %}{{ request.user.traveller.image.url }}{% else %}/static/default-user.png{% endif %}" 
                 class="rounded-circle me-2" style="width: 30px; height: 30px;">
            
            <p class="fw-bold text-white ms-1 mb-0 d-flex align-items-center">
                {% if request.user.traveller.has_premium_access %}
                    <span title="Premium User" class="me-1 fs-4">👑</span>
                {% endif %}
                {{ request.user.first_name }} {{ request.user.last_name }}
            </p>
        </a>
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
            <li><a class="dropdown-item" style="color: #11062e;" href="{% url 'logout' %}">Logout</a></li>
        </ul>
    </div>
{% endif %}


                        
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    {% block section %}{% endblock %}

    <!-- Footer -->
    <footer class="footer" style="background-color: #340f6e;">
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <h5 class="text-primary">About SmartVoyager</h5>
                    <p>Discover places. Record memories. Share journeys. Your digital travel diary starts here.</p>
                </div>
                <div class="col-md-4">
                    <h5 class="text-primary">Quick Links</h5>
                    <ul class="list-unstyled ">
                        <li><a href="{% url 'home' %}" class="text-info">Home</a></li>
                        <li><a href="{% url 'about' %}" class="text-info">About</a></li>
                        <li><a href="{% url 'build_route' %}" class="text-info">Trip Planner</a></li>
                        <li><a href="{% url 'contact' %}" class="text-info">Contact</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5 class="text-primary">Contact</h5>
                    <p>
  Email: <a href="mailto:contact@smartVoyeger.com" style="text-decoration:none;">contact@smartVoyeger.com</a><br>
  Phone: <a href="tel:+916238483490" style="text-decoration:none;">+91 623 848 3490</a>
</p>
                </div>
            </div>
        </div>
    </footer>
</div>

<!-- JS -->
<script src="/static/js/jquery-3.2.1.min.js"></script>
<!-- <script src="/static/styles/bootstrap4/popper.js"></script> -->
<!-- <script src="/static/styles/bootstrap4/bootstrap.min.js"></script> -->
<script src="/static/plugins/OwlCarousel2-2.2.1/owl.carousel.js"></script>
<script src="/static/plugins/easing/easing.js"></script>
<script src="/static/js/custom.js"></script>

<!-- Location Toast -->
<div class="position-fixed top-0 end-0 p-3" style="z-index: 1055">
  <div id="locationToast" class="toast align-items-center text-bg-primary border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body" id="toastBody">
        Fetching location...
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>
</div>


<!-- Floating Chat Icon -->
<div id="chatbot-container" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999;">
  <button id="chat-toggle">💬</button>
  <div id="chatbox" class="chatbox">
    <div id="chatbox-header">SmartVoyager AI</div>
    <div id="chat-messages" class="chatbox-messages"></div>
    <div id="chatbox-footer">
      <input id="chat-input" type="text" placeholder="Ask something..." />
      <button id="chat-send">Send</button>
    </div>
  </div>
</div>

<!-- Toast for location -->
<div class="position-fixed top-0 end-0 p-3" style="z-index: 1055">
  <div id="locationToast" class="toast align-items-center text-bg-primary border-0" role="alert">
    <div class="d-flex">
      <div class="toast-body" id="toastBody">Fetching location...</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const chatToggle = document.getElementById("chat-toggle");
  const chatbox = document.getElementById("chatbox");
  const input = document.getElementById("chat-input");
  const sendBtn = document.getElementById("chat-send");
  const messagesDiv = document.getElementById("chat-messages");

  let userLat = null;
  let userLng = null;
  let locationFetched = false;

  // ✅ Toggle chat visibility
  chatToggle.addEventListener("click", function () {
    chatbox.style.display = (chatbox.style.display === "none" || chatbox.style.display === "") ? "flex" : "none";
  });

  // Send message on button click or Enter key
  sendBtn.addEventListener("click", sendChat);
  input.addEventListener("keydown", function (event) {
    if (event.key === "Enter") {
      event.preventDefault();
      sendChat();
    }
  });

  function sendChat() {
    const message = input.value.trim();
    if (!message) return;

    messagesDiv.innerHTML += `<div><strong>You:</strong> ${message}</div>`;
    input.value = "";

    const csrfToken = document.cookie
      .split("; ")
      .find(row => row.startsWith("csrftoken="))
      ?.split("=")[1];

    if (!locationFetched && navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        function (position) {
          userLat = position.coords.latitude;
          userLng = position.coords.longitude;
          locationFetched = true;

          const toastBody = document.getElementById("toastBody");
          if (toastBody) {
            toastBody.innerText = `📍 Your location: Latitude ${userLat.toFixed(4)}, Longitude ${userLng.toFixed(4)}`;
            const toast = new bootstrap.Toast(document.getElementById("locationToast"));
            toast.show();
          }

          sendMessageToBot(message, csrfToken);
        },
        function () {
          locationFetched = true;
          sendMessageToBot(message, csrfToken);
        }
      );
    } else {
      sendMessageToBot(message, csrfToken);
    }
  }

  function formatBotResponse(response) {
    const lines = response.split(/\n|(?<=\.)\s+/);
    const filtered = lines.filter(line => line.trim().length > 0);
    return `<ul>` + filtered.map(line => `<li>${line.trim()}</li>`).join('') + `</ul>`;
  }

  function sendMessageToBot(message, csrfToken) {
    const formData = new URLSearchParams({ message });

    if (userLat && userLng) {
      formData.append("latitude", userLat);
      formData.append("longitude", userLng);
    }

    // ✅ Dynamic thinking message
    const thinkingId = `thinking-${Date.now()}`;
    const thinkingMessages = [
      "🤔 Let me think a moment...",
      "🧳 Planning your trip...",
      "✈️ Searching great places for you...",
      "📍 Finding the best spots..."
    ];
    const thinkingText = thinkingMessages[Math.floor(Math.random() * thinkingMessages.length)];
    messagesDiv.innerHTML += `<div id="${thinkingId}"><strong>Bot:</strong> ${thinkingText}</div>`;
    messagesDiv.scrollTop = messagesDiv.scrollHeight;

    fetch("/chatbot/chat/", {
      method: "POST",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded",
        "X-CSRFToken": csrfToken,
      },
      body: formData,
    })
      .then(res => res.json())
      .then(data => {
        const thinkingDiv = document.getElementById(thinkingId);
        if (data.response) {
          thinkingDiv.innerHTML = `<strong>Bot:</strong> ${formatBotResponse(data.response)}`;
        } else if (data.error) {
          thinkingDiv.innerHTML = `<strong>Error:</strong> ${data.error}`;
        } else {
          thinkingDiv.innerHTML = `<strong>Error:</strong> Unknown error occurred.`;
        }
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
      })
      .catch(err => {
        console.error("Network error:", err);
        const thinkingDiv = document.getElementById(thinkingId);
        thinkingDiv.innerHTML = `<strong>Error:</strong> Network error`;
      });
  }
});
</script>

{% block scripts %}{% endblock %}
</body>
</html>
